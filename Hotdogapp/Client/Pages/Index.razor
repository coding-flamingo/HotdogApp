@page "/"
@using Hotdogapp.Shared.Models
@using Hotdogapp.Shared.Services
@using System.IO
@using BlazorInputFile
@inject NavigationManager navigationManager
@inject HttpClient _httpClient



<InputFile id="image-picker" OnChange="HandlePhotoSelected" accept="image/*" />
<br />
<label class="text-button" for="image-picker">
    <img src="@_photoURL"  />
</label>
<br />
<button @onclick="PerformHotDogCheck" class="btn btn-success" type="button">Submit Image</button>
@if (_hotDogResult != null)
{
    @_hotDogResult.accuracy
}




@code
{
    private string _photoURL;
    private bool isDetectingHotDog;
    private HotDogResultModel _hotDogResult;


    private async Task HandlePhotoSelected(IFileListEntry[] files)
    {
        var sourceFile = files.FirstOrDefault();
        if (sourceFile != null)
        {
            // Convert to reasonably-sized JPEG
            var imageFile = await sourceFile.ToImageFileAsync("image/jpeg", 800, 600);

            // Represent it as a data URL we can display
            MemoryStream bytes = await imageFile.ReadAllAsync();
            _photoURL = bytes.ToDataUrl("image/jpeg");
        }
    }

    private async Task PerformHotDogCheck()
    {
        isDetectingHotDog = true;
        var response = await _httpClient.PostAsync("api/DetectHotDog", new StringContent(_photoURL));
        _hotDogResult = await response.Content.ReadFromJsonAsync<HotDogResultModel>();


        isDetectingHotDog = false;
    }
}